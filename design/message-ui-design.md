# ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸UIè¨­è¨ˆä»•æ§˜æ›¸

## ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

VRChatã‚­ãƒ£ã‚¹ãƒˆå‹Ÿé›†æ²ç¤ºæ¿ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ©Ÿèƒ½ã¯ã€å¿œå‹Ÿè€…ã¨æŠ•ç¨¿è€…é–“ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¿ƒé€²ã™ã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã§ã™ã€‚

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

### 1. MessageModal.vueï¼ˆãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰

#### æ¦‚è¦
å¿œå‹Ÿè©³ç´°ç”»é¢ã‚„é€šçŸ¥ã‹ã‚‰èµ·å‹•ã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ€ãƒ«

#### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Message Modal (600x500px)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       Header (60px)                         â”‚
â”‚  â† [æˆ»ã‚‹]  ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å [ã‚ªãƒ³ãƒ©ã‚¤ãƒ³]           [âœ• é–‰ã˜ã‚‹] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚                  Message List (380px)                      â”‚
â”‚                   [ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½]                          â”‚
â”‚                                                             â”‚
â”‚  [ç›¸æ‰‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸]    [è‡ªåˆ†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸]                       â”‚
â”‚      â†“                   â†“                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚   â”‚ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸  â”‚      â”‚ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸  â”‚                     â”‚
â”‚   â”‚ å†…å®¹...     â”‚      â”‚ å†…å®¹...     â”‚                     â”‚
â”‚   â”‚ 12:34       â”‚      â”‚ 12:35       â”‚                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Message Input (60px)                     â”‚
â”‚  ğŸ“ [ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...                    ] [é€ä¿¡]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Vue.jså®Ÿè£…ä»•æ§˜
```vue
<template>
  <div class="message-modal-overlay" @click="$emit('close')">
    <div class="message-modal" @click.stop>
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <header class="message-header">
        <div class="header-left">
          <button class="back-button" @click="$emit('close')">
            <ArrowLeftIcon class="w-5 h-5" />
          </button>
          <div class="user-info">
            <img :src="recipient.avatar" :alt="recipient.name" class="user-avatar" />
            <div class="user-details">
              <h3 class="user-name">{{ recipient.name }}</h3>
              <span class="user-status" :class="statusClasses">
                <div class="status-dot"></div>
                {{ recipient.isOnline ? 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³' : 'æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³: ' + formatLastSeen(recipient.lastSeen) }}
              </span>
            </div>
          </div>
        </div>
        <button class="close-button" @click="$emit('close')">
          <XMarkIcon class="w-6 h-6" />
        </button>
      </header>

      <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆ -->
      <MessageList
        ref="messageListRef"
        :messages="messages"
        :current-user-id="currentUserId"
        :loading="loading"
        @scroll-to-top="loadMoreMessages"
      />

      <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ› -->
      <MessageInput
        :disabled="sending"
        :placeholder="inputPlaceholder"
        @send="handleSendMessage"
        @typing="handleTyping"
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue'
import { ArrowLeftIcon, XMarkIcon } from '@heroicons/vue/24/outline'
import MessageList from './MessageList.vue'
import MessageInput from './MessageInput.vue'
import type { User, Message } from '@/types'

interface Props {
  recipient: User
  currentUserId: string
  initialMessages?: Message[]
}

const props = defineProps<Props>()
const emit = defineEmits<{
  close: []
  messagesSent: [message: Message]
}>()

// State
const messages = ref<Message[]>(props.initialMessages || [])
const loading = ref(false)
const sending = ref(false)
const messageListRef = ref()

// Computed
const statusClasses = computed(() => ({
  'status-online': props.recipient.isOnline,
  'status-offline': !props.recipient.isOnline
}))

const inputPlaceholder = computed(() => 
  props.recipient.isOnline 
    ? `${props.recipient.name}ã•ã‚“ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡`
    : 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ï¼ˆç›¸æ‰‹ãŒã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã™ï¼‰'
)

// Methods
const handleSendMessage = async (content: string, type: 'text' | 'image' = 'text') => {
  if (sending.value) return
  
  sending.value = true
  try {
    const newMessage = {
      id: Date.now().toString(), // ä»®ID
      content,
      type,
      senderId: props.currentUserId,
      recipientId: props.recipient.id,
      timestamp: new Date().toISOString(),
      status: 'sending' as const
    }
    
    // æ¥½è¦³çš„UIæ›´æ–°
    messages.value.push(newMessage)
    scrollToBottom()
    
    // APIé€ä¿¡
    const { messagesApi } = await import('@/lib/messagesApi')
    const result = await messagesApi.sendMessage({
      recipient_id: props.recipient.id,
      content,
      message_type: type
    })
    
    if (result.error) {
      // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ä»®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
      messages.value = messages.value.filter(m => m.id !== newMessage.id)
      throw new Error(result.error)
    }
    
    // æˆåŠŸæ™‚ã¯ä»®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æœ¬ç‰©ã¨ç½®æ›
    const index = messages.value.findIndex(m => m.id === newMessage.id)
    if (index !== -1) {
      messages.value[index] = result.data
    }
    
    emit('messagesSent', result.data)
  } catch (error) {
    console.error('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error)
  } finally {
    sending.value = false
  }
}

const scrollToBottom = () => {
  messageListRef.value?.scrollToBottom()
}

// Lifecycle
onMounted(() => {
  scrollToBottom()
})
</script>

<style scoped>
.message-modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.message-modal {
  width: 600px;
  height: 500px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.message-header {
  height: 60px;
  padding: 0 16px;
  border-bottom: 1px solid #E5E7EB;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #F9FAFB;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.back-button, .close-button {
  padding: 8px;
  border-radius: 8px;
  border: none;
  background: transparent;
  color: #6B7280;
  cursor: pointer;
  transition: all 0.2s;
}

.back-button:hover, .close-button:hover {
  background: #E5E7EB;
  color: #374151;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.user-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
}

.user-name {
  font-size: 16px;
  font-weight: 600;
  color: #111827;
  margin: 0;
}

.user-status {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: #6B7280;
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #9CA3AF;
}

.status-online .status-dot {
  background: #10B981;
}

/* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
@media (max-width: 768px) {
  .message-modal {
    width: 100vw;
    height: 100vh;
    border-radius: 0;
  }
  
  .message-header {
    padding: 0 12px;
  }
  
  .user-name {
    font-size: 14px;
  }
}
</style>
```

### 2. MessageList.vueï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ï¼‰

#### æ¦‚è¦
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸€è¦§è¡¨ç¤ºã¨ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç®¡ç†

#### å®Ÿè£…ä»•æ§˜
```vue
<template>
  <div ref="scrollContainer" class="message-list" @scroll="handleScroll">
    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆä¸Šéƒ¨ï¼‰ -->
    <div v-if="loading" class="loading-more">
      <div class="spinner"></div>
      <span>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</span>
    </div>
    
    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¾¤ -->
    <div class="messages-container">
      <MessageBubble
        v-for="message in messages"
        :key="message.id"
        :message="message"
        :is-own="message.senderId === currentUserId"
        :show-avatar="shouldShowAvatar(message, messages)"
        :show-timestamp="shouldShowTimestamp(message, messages)"
      />
    </div>
    
    <!-- ã‚¿ã‚¤ãƒ”ãƒ³ã‚°è¡¨ç¤º -->
    <div v-if="isTyping" class="typing-indicator">
      <div class="typing-bubble">
        <div class="typing-dots">
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, nextTick, onMounted } from 'vue'
import MessageBubble from './MessageBubble.vue'
import type { Message } from '@/types'

interface Props {
  messages: Message[]
  currentUserId: string
  loading?: boolean
  isTyping?: boolean
}

const props = defineProps<Props>()
const emit = defineEmits<{
  scrollToTop: []
}>()

const scrollContainer = ref<HTMLElement>()

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ç”¨ã®åˆ¤å®š
const shouldShowAvatar = (message: Message, messages: Message[]) => {
  const index = messages.findIndex(m => m.id === message.id)
  const nextMessage = messages[index + 1]
  
  return !nextMessage || 
         nextMessage.senderId !== message.senderId ||
         isNewTimeGroup(message, nextMessage)
}

const shouldShowTimestamp = (message: Message, messages: Message[]) => {
  const index = messages.findIndex(m => m.id === message.id)
  const prevMessage = messages[index - 1]
  
  return !prevMessage || 
         prevMessage.senderId !== message.senderId ||
         isNewTimeGroup(prevMessage, message)
}

const isNewTimeGroup = (message1: Message, message2: Message) => {
  const time1 = new Date(message1.timestamp)
  const time2 = new Date(message2.timestamp)
  return time2.getTime() - time1.getTime() > 300000 // 5åˆ†
}

const scrollToBottom = () => {
  nextTick(() => {
    if (scrollContainer.value) {
      scrollContainer.value.scrollTop = scrollContainer.value.scrollHeight
    }
  })
}

const handleScroll = () => {
  if (scrollContainer.value?.scrollTop === 0) {
    emit('scrollToTop')
  }
}

defineExpose({ scrollToBottom })
</script>

<style scoped>
.message-list {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  background: #F9FAFB;
}

.loading-more {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 16px;
  color: #6B7280;
  font-size: 14px;
}

.spinner {
  width: 16px;
  height: 16px;
  border: 2px solid #E5E7EB;
  border-top: 2px solid #3B82F6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.messages-container {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.typing-indicator {
  display: flex;
  justify-content: flex-start;
  margin-top: 12px;
}

.typing-bubble {
  background: white;
  border-radius: 18px;
  padding: 12px 16px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  border: 1px solid #E5E7EB;
}

.typing-dots {
  display: flex;
  gap: 4px;
}

.dot {
  width: 6px;
  height: 6px;
  background: #9CA3AF;
  border-radius: 50%;
  animation: typing 1.4s infinite ease-in-out;
}

.dot:nth-child(1) { animation-delay: 0ms; }
.dot:nth-child(2) { animation-delay: 200ms; }
.dot:nth-child(3) { animation-delay: 400ms; }

@keyframes typing {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-10px); }
}
</style>
```

### 3. MessageBubble.vueï¼ˆå€‹åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰

#### å®Ÿè£…ä»•æ§˜
```vue
<template>
  <div class="message-wrapper" :class="{ 'own-message': isOwn }">
    <!-- ã‚¢ãƒã‚¿ãƒ¼ï¼ˆä»–è€…ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿ï¼‰ -->
    <img 
      v-if="!isOwn && showAvatar" 
      :src="message.sender?.avatar || '/default-avatar.png'"
      :alt="message.sender?.name"
      class="message-avatar"
    />
    
    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ–ãƒ« -->
    <div class="message-bubble" :class="bubbleClasses">
      <!-- ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <div v-if="message.type === 'text'" class="message-text">
        {{ message.content }}
      </div>
      
      <!-- ç”»åƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <div v-else-if="message.type === 'image'" class="message-image">
        <img :src="message.content" alt="é€ä¿¡ã•ã‚ŒãŸç”»åƒ" @click="showImageModal" />
      </div>
      
      <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— -->
      <div v-if="showTimestamp" class="message-meta">
        <span class="message-time">{{ formatTime(message.timestamp) }}</span>
        <span v-if="isOwn && message.status" class="message-status" :class="statusClasses">
          {{ statusLabels[message.status] }}
        </span>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import type { Message } from '@/types'

interface Props {
  message: Message
  isOwn: boolean
  showAvatar?: boolean
  showTimestamp?: boolean
}

const props = defineProps<Props>()

const bubbleClasses = computed(() => ({
  'bubble-own': props.isOwn,
  'bubble-other': !props.isOwn,
  'bubble-sending': props.message.status === 'sending',
  'bubble-error': props.message.status === 'error'
}))

const statusClasses = computed(() => ({
  'status-sending': props.message.status === 'sending',
  'status-sent': props.message.status === 'sent',
  'status-read': props.message.status === 'read',
  'status-error': props.message.status === 'error'
}))

const statusLabels = {
  sending: 'é€ä¿¡ä¸­...',
  sent: 'é€ä¿¡æ¸ˆã¿',
  read: 'æ—¢èª­',
  error: 'é€ä¿¡å¤±æ•—'
}

const formatTime = (timestamp: string) => {
  const date = new Date(timestamp)
  return date.toLocaleTimeString('ja-JP', { 
    hour: '2-digit', 
    minute: '2-digit' 
  })
}

const showImageModal = () => {
  // ç”»åƒãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºã®å®Ÿè£…
}
</script>

<style scoped>
.message-wrapper {
  display: flex;
  align-items: flex-end;
  gap: 8px;
  margin-bottom: 4px;
}

.message-wrapper.own-message {
  justify-content: flex-end;
}

.message-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
}

.message-bubble {
  max-width: 70%;
  padding: 12px 16px;
  border-radius: 18px;
  position: relative;
  word-wrap: break-word;
}

.bubble-other {
  background: white;
  border: 1px solid #E5E7EB;
  border-bottom-left-radius: 4px;
}

.bubble-own {
  background: #3B82F6;
  color: white;
  border-bottom-right-radius: 4px;
}

.bubble-sending {
  opacity: 0.7;
}

.bubble-error {
  background: #FEF2F2;
  border: 1px solid #FECACA;
  color: #991B1B;
}

.message-text {
  line-height: 1.4;
  font-size: 15px;
}

.message-image img {
  max-width: 200px;
  max-height: 200px;
  border-radius: 8px;
  cursor: pointer;
  transition: transform 0.2s;
}

.message-image img:hover {
  transform: scale(1.02);
}

.message-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 4px;
  font-size: 11px;
  opacity: 0.7;
}

.message-time {
  font-weight: 500;
}

.message-status {
  font-size: 10px;
}

.status-sending { color: #F59E0B; }
.status-sent { color: #6B7280; }
.status-read { color: #10B981; }
.status-error { color: #EF4444; }

/* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
@media (max-width: 768px) {
  .message-bubble {
    max-width: 85%;
    padding: 10px 14px;
  }
  
  .message-text {
    font-size: 14px;
  }
  
  .message-image img {
    max-width: 150px;
    max-height: 150px;
  }
}
</style>
```

### 4. MessageInput.vueï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›ï¼‰

#### å®Ÿè£…ä»•æ§˜
```vue
<template>
  <div class="message-input-container">
    <!-- ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠï¼ˆéè¡¨ç¤ºï¼‰ -->
    <input 
      ref="fileInput" 
      type="file" 
      accept="image/*" 
      style="display: none" 
      @change="handleFileSelect"
    />
    
    <div class="input-wrapper">
      <!-- æ·»ä»˜ãƒœã‚¿ãƒ³ -->
      <button 
        class="attach-button" 
        @click="fileInput?.click()"
        :disabled="disabled"
      >
        <PaperClipIcon class="w-5 h-5" />
      </button>
      
      <!-- ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› -->
      <textarea
        ref="textInput"
        v-model="message"
        :placeholder="placeholder"
        :disabled="disabled"
        class="message-textarea"
        rows="1"
        @keydown="handleKeydown"
        @input="handleInput"
      />
      
      <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
      <button 
        class="send-button" 
        :disabled="!canSend || disabled"
        @click="sendMessage"
      >
        <PaperAirplaneIcon class="w-5 h-5" />
      </button>
    </div>
    
    <!-- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <div v-if="selectedImage" class="image-preview">
      <img :src="selectedImage.preview" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" />
      <button class="remove-image" @click="removeImage">
        <XMarkIcon class="w-4 h-4" />
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, nextTick } from 'vue'
import { PaperClipIcon, PaperAirplaneIcon, XMarkIcon } from '@heroicons/vue/24/outline'

interface Props {
  placeholder?: string
  disabled?: boolean
  maxLength?: number
}

const props = withDefaults(defineProps<Props>(), {
  placeholder: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...',
  maxLength: 1000
})

const emit = defineEmits<{
  send: [content: string, type: 'text' | 'image']
  typing: [isTyping: boolean]
}>()

// State
const message = ref('')
const selectedImage = ref<{ file: File; preview: string } | null>(null)
const textInput = ref<HTMLTextAreaElement>()
const fileInput = ref<HTMLInputElement>()
const typingTimeout = ref<number>()

// Computed
const canSend = computed(() => 
  (message.value.trim().length > 0 || selectedImage.value) && 
  message.value.length <= props.maxLength
)

// Methods
const sendMessage = async () => {
  if (!canSend.value) return
  
  if (selectedImage.value) {
    // ç”»åƒé€ä¿¡
    const imageUrl = await uploadImage(selectedImage.value.file)
    emit('send', imageUrl, 'image')
    removeImage()
  } else {
    // ãƒ†ã‚­ã‚¹ãƒˆé€ä¿¡
    emit('send', message.value.trim(), 'text')
  }
  
  message.value = ''
  emit('typing', false)
  adjustTextareaHeight()
}

const handleKeydown = (event: KeyboardEvent) => {
  if (event.key === 'Enter' && !event.shiftKey) {
    event.preventDefault()
    sendMessage()
  }
}

const handleInput = () => {
  adjustTextareaHeight()
  
  // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°é€šçŸ¥
  emit('typing', true)
  clearTimeout(typingTimeout.value)
  typingTimeout.value = setTimeout(() => {
    emit('typing', false)
  }, 1000)
}

const adjustTextareaHeight = () => {
  nextTick(() => {
    if (textInput.value) {
      textInput.value.style.height = 'auto'
      textInput.value.style.height = `${Math.min(textInput.value.scrollHeight, 120)}px`
    }
  })
}

const handleFileSelect = (event: Event) => {
  const file = (event.target as HTMLInputElement).files?.[0]
  if (!file) return
  
  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ5MBåˆ¶é™ï¼‰
  if (file.size > 5 * 1024 * 1024) {
    alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯5MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„')
    return
  }
  
  const preview = URL.createObjectURL(file)
  selectedImage.value = { file, preview }
}

const removeImage = () => {
  if (selectedImage.value) {
    URL.revokeObjectURL(selectedImage.value.preview)
    selectedImage.value = null
  }
}

const uploadImage = async (file: File): Promise<string> => {
  // ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã®å®Ÿè£…
  const formData = new FormData()
  formData.append('image', file)
  
  // TODO: å®Ÿéš›ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰APIå‘¼ã³å‡ºã—
  return 'https://example.com/uploaded-image.jpg'
}
</script>

<style scoped>
.message-input-container {
  border-top: 1px solid #E5E7EB;
  background: white;
  padding: 16px;
}

.input-wrapper {
  display: flex;
  align-items: flex-end;
  gap: 8px;
}

.attach-button, .send-button {
  flex-shrink: 0;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
}

.attach-button {
  background: #F3F4F6;
  color: #6B7280;
}

.attach-button:hover:not(:disabled) {
  background: #E5E7EB;
  color: #374151;
}

.send-button {
  background: #3B82F6;
  color: white;
}

.send-button:hover:not(:disabled) {
  background: #1D4ED8;
}

.send-button:disabled {
  background: #D1D5DB;
  cursor: not-allowed;
}

.message-textarea {
  flex: 1;
  min-height: 40px;
  max-height: 120px;
  padding: 10px 16px;
  border: 1px solid #D1D5DB;
  border-radius: 20px;
  resize: none;
  font-size: 15px;
  line-height: 1.4;
  outline: none;
  transition: border-color 0.2s;
}

.message-textarea:focus {
  border-color: #3B82F6;
}

.message-textarea:disabled {
  background: #F9FAFB;
  color: #9CA3AF;
}

.image-preview {
  position: relative;
  margin-top: 12px;
  display: inline-block;
}

.image-preview img {
  max-width: 150px;
  max-height: 150px;
  border-radius: 8px;
  border: 1px solid #E5E7EB;
}

.remove-image {
  position: absolute;
  top: -8px;
  right: -8px;
  width: 24px;
  height: 24px;
  background: #EF4444;
  color: white;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
@media (max-width: 768px) {
  .message-input-container {
    padding: 12px;
  }
  
  .attach-button, .send-button {
    width: 36px;
    height: 36px;
  }
  
  .message-textarea {
    font-size: 16px; /* iOS zoomé˜²æ­¢ */
  }
}
</style>
```

## ä½¿ç”¨ä¾‹ãƒ»çµ±åˆæ–¹æ³•

### ApplicationsView.vueã§ã®ä½¿ç”¨
```vue
<template>
  <div>
    <!-- æ—¢å­˜ã®å¿œå‹Ÿä¸€è¦§ -->
    <div v-for="application in applications" :key="application.id">
      <!-- æ—¢å­˜ã®å¿œå‹Ÿã‚«ãƒ¼ãƒ‰ -->
      <button @click="openMessage(application.applicant)">
        ğŸ’¬ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      </button>
    </div>
    
    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <MessageModal
      v-if="showMessageModal && selectedUser"
      :recipient="selectedUser"
      :current-user-id="authStore.user.id"
      @close="closeMessage"
      @messages-sent="handleMessageSent"
    />
  </div>
</template>

<script setup>
import MessageModal from '@/components/message/MessageModal.vue'

const showMessageModal = ref(false)
const selectedUser = ref(null)

const openMessage = (user) => {
  selectedUser.value = user
  showMessageModal.value = true
}

const closeMessage = () => {
  showMessageModal.value = false
  selectedUser.value = null
}
</script>
```

## ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½

### WebSocket/Supabase Realtimeçµ±åˆ
```typescript
// composables/useMessages.ts
import { ref, onUnmounted } from 'vue'
import { supabase } from '@/lib/supabase'

export const useMessages = (userId: string) => {
  const messages = ref<Message[]>([])
  const isTyping = ref(false)
  
  // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è³¼èª­
  const subscription = supabase
    .channel('messages')
    .on('postgres_changes', {
      event: 'INSERT',
      schema: 'public',
      table: 'messages',
      filter: `recipient_id=eq.${userId}`
    }, (payload) => {
      messages.value.push(payload.new as Message)
    })
    .on('presence', { event: 'sync' }, () => {
      // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã®æ›´æ–°
    })
    .subscribe()
  
  onUnmounted(() => {
    subscription.unsubscribe()
  })
  
  return {
    messages,
    isTyping
  }
}
```

ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸UIè¨­è¨ˆã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã®ã‚¹ãƒ ãƒ¼ã‚ºãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿç¾ã•ã‚Œã€å¿œå‹Ÿãƒ»æ¡ç”¨ãƒ—ãƒ­ã‚»ã‚¹ãŒå¤§å¹…ã«æ”¹å–„ã•ã‚Œã¾ã™ã€‚